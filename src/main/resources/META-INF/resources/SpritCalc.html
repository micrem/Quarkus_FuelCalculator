<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>SpritCalcApp</title>

    <meta content="Source code generated using layoutit.com" name="description">
    <meta content="LayoutIt!" name="author">

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <style>
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>

</head>
<body>


<div class="container-fluid" id="container" style="width: 300px; ">
    <div class="row">
        <div class="col text-center">
            <img class="img-fluid p-3" id="logo" name="logo" src="img/logo.png" style="opacity:0"/>
        </div>

        <div class="col-md-12 text-center p-2" id="formContainer" style="opacity:0">
            <hr/>
            <h3 class="">
                SpritCalc
            </h3>
            </h3>
            <hr/>
            <form action="" id="form" method="GET" role="form">
                <div class="row d-none">
                    <div class="form-group col">
                        <label class="">Standort</label>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col ">
                        <input class="form-control" id="city" name="city" placeholder="Stadt" required type=text>
                    </div>
                    <div class="form-group col-4 pl-0 ml-0">
                        <input class="form-control" id="PLZ" max="99999" min="0" name="PLZ" placeholder="PLZ"
                               type=number>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group col ">
                        <input class="form-control" id="street" name="street" placeholder="Straße" type=text>
                    </div>

                    <div class="form-group col-3 pl-0 ml-0">
                        <input class="form-control" id="streetNum" name="streetNum" placeholder="Nr." type=number>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group col-7">
                        <label for="inputSpritTyp">Sprittyp</label>
                        <select class="form-control" id="inputSpritTyp" name="inputSpritTyp" type=text>
                            <option>all</option>
                            <option>diesel</option>
                            <option selected>e10</option>
                            <option>e5</option>
                        </select>
                    </div>
                    <div class="form-group col pl-0 ml-0">
                        <label for="Verbrauch">Verbrauch</label>
                        <input class="form-control" id="Verbrauch" name="Verbrauch" placeholder="l/100km" required
                               type=number>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group col">
                        <label for="Tankmenge">Gewünschte Tankmenge (Liter)</label>
                        <input class="form-control" id="Tankmenge" name="Tankmenge" required type=number>
                    </div>
                </div>

                <div class="row">
                    <div class="checkbox d-none">
                        <label>
                            <input type="checkbox"> checkboxy
                        </label>
                    </div>
                    <div class="form-group col">
                        <div class="btn btn-primary" onclick="buttonPress()">Submit</div>
                        <!-- ONLINE <div class="btn btn-primary" onclick="callAPI()">Submit</div> -->
                        <!-- OFFLINE <div class="btn btn-primary" onclick="getDataOffline()">Submit</div> -->
                    </div>

                </div>
            </form>
        </div>
    </div>
</div>
<div class="container d-none text-center p-5" id="loadingSpinner" style="opacity:0">
    <img alt="Loading.." src="img/15.gif"/>
</div>
<div class="d-none" id="responseContainer" style="opacity:0">
    <div class="container-fluid text-center" style="width: 300px; height: 0px">

        <div class="row text-center">
            <hr/>
            <h3 class="">
                Billigste Tankmöglichkeiten</br>
            </h3>
            <hr/>
        </div>

        <div id="resultVerbrauch" class="row text-center"></div>

        <div id="resultTankmenge" class="row text-center"></div>

        <div class="row-fluid my-3" id="card1">
            <div class="card text-center">
                <h5 class="card-header" name="header">1</h5>
                <div class="card-body">
                    <h2 class="card-title" name="stationName">StationName</h2>
                    <ul class="list-group list-group-flush ">
                        <li class="list-group-item" name="totalCost">Gesamtpreis</li>
                        <li class="list-group-item" name="petrolCost">Spritpreis</li>
                        <li class="list-group-item" name="routeCost">Davon Fahrkosten</li>
                        <li class="list-group-item" name="distance">Entfernung</li>
                        <li class="list-group-item" name="adress">Adresse1</li>
                        <li class="list-group-item" name="adress2">Adresse2</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row-fluid my-3" id="card2">
            <div class="card text-center">
                <h5 class="card-header" name="header">1</h5>
                <div class="card-body">
                    <h2 class="card-title" name="stationName">StationName</h2>
                    <ul class="list-group list-group-flush ">
                        <li class="list-group-item" name="totalCost">Gesamtpreis</li>
                        <li class="list-group-item" name="petrolCost">Spritpreis</li>
                        <li class="list-group-item" name="routeCost">Davon Fahrkosten</li>
                        <li class="list-group-item" name="distance">Entfernung</li>
                        <li class="list-group-item" name="adress">Adresse1</li>
                        <li class="list-group-item" name="adress2">Adresse2</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row-fluid my-3" id="card3">
            <div class="card text-center">
                <h5 class="card-header" name="header">1</h5>
                <div class="card-body">
                    <h2 class="card-title" name="stationName">StationName</h2>
                    <ul class="list-group list-group-flush ">
                        <li class="list-group-item" name="totalCost">Gesamtpreis</li>
                        <li class="list-group-item" name="petrolCost">Spritpreis</li>
                        <li class="list-group-item" name="routeCost">Davon Fahrkosten</li>
                        <li class="list-group-item" name="distance">Entfernung</li>
                        <li class="list-group-item" name="adress">Adresse1</li>
                        <li class="list-group-item" name="adress2">Adresse2</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row-fluid my-3">
            <span class="text-muted"><small>(für mehr Ergebnisse </br> bitte Vollversion erwerben)</small></span>
        </div>
    </div>
</div>

</div>
</div>

<script src="js/jquery.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/scripts.js"></script>

<script>  //SpritCalc Animationen + API-Calls
const useTestData = false;
    $("#logo").animate({opacity: '1'}, "slow",
        function () {
            $("#formContainer").animate({opacity: '1'}, "slow");
            $("#logo").animate({width: '150px'}, "slow");
        }
    );

    var responseSpritApi = null;

    var exampleResponse = [
        {
            "completePrice": 10.677528,
            "petrolStationDat": {
                "brand": "OFFLINE TESTDATA Freie Automatentankstelle",
                "distance": 6.7,
                "geographicLatitude": 49.148681640625,
                "geographicLongitude": 8.9788904190063,
                "houseNumber": "14",
                "id": "2d2889b6-69ee-49c1-8b9b-ad4cc278b7b9",
                "name": "OFFLINE TANKESTELLE",
                "open": true,
                "placeNamer": "Gemmingen",
                "postCode": 75050,
                "price": 1.249,
                "street": "Gottlieb-Daimler-Str."
            },
            "routeData": {
                "distance": 8569.1,
                "duration": 695.1
            },
            "travelcost": 0.685528,
            "uuid": "e260a58b-e8c2-4e51-9b47-e78622b28a7a"
        },
        {
            "completePrice": 10.799071999999999,
            "petrolStationDat": {
                "brand": "ARAL",
                "distance": 3.5,
                "geographicLatitude": 49.0664024,
                "geographicLongitude": 9.011304,
                "houseNumber": "70",
                "id": "8329aa4a-0ccb-4986-a491-45182919ab53",
                "name": "Aral Tankstelle",
                "open": false,
                "placeNamer": "Güglingen",
                "postCode": 74363,
                "price": 1.299,
                "street": "Heilbronner Straße"
            },
            "routeData": {
                "distance": 5088.4,
                "duration": 475.3
            },
            "travelcost": 0.407072,
            "uuid": "72765b63-efbe-42b5-99b5-de1686909662"
        },
        {
            "completePrice": 10.997144,
            "petrolStationDat": {
                "brand": "MTB",
                "distance": 9.9,
                "geographicLatitude": 49.02148,
                "geographicLongitude": 9.09775,
                "houseNumber": "14",
                "id": "25aa4243-840a-48b7-b6c9-7dd6e5d53cc0",
                "name": "MTB Tankstelle",
                "open": true,
                "placeNamer": "Erligheim",
                "postCode": 74391,
                "price": 1.249,
                "street": "Bönnigheimer Str."
            },
            "routeData": {
                "distance": 12564.3,
                "duration": 913.8
            },
            "travelcost": 1.005144,
            "uuid": "202d7a37-7021-49fd-b160-ed95ee0f6b36"
        }
    ];

    function buttonPress(){
        if(useTestData){
            getTestData();
        } else {
            getAPIData();
        }
    }

    /*
    var responseJson;
    const testCall = async () => {
        const response = await fetch('http://localhost:8080/SpritCalc?' +
            'city=' + city +
            '&PLZ=' + PLZ +
            '&street=' + street +
            '&streetNum=' + streetNum +
            '&inputSpritTyp=' + inputSpritTyp +
            '&Verbrauch=' + Verbrauch +
            '&Tankmenge=' + Tankmenge, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        responseJson = await response.json(); //extract JSON from the http response

    }; */


    const getAPIData = function () {

        if ($("#form")[0].reportValidity() == false) return;

        let url = generateAPIURLfromForm();

        fetch(url)
            .then((ret) => ret.json())
            .then(ret => {
                console.log(ret);
                return ret;
            })
            .then(ret => {
                responseSpritApi = ret;
                return ret;
            })
            .then( writeValuesToDOM ).then(async function () {
                $("#loadingSpinner").animate({opacity: '0'}, "fast",
                    function () {
                        console.log("showing results");
                        $("#loadingSpinner").addClass("d-none");
                        $("#responseContainer").removeClass("d-none");
                        $("#responseContainer").animate({opacity: '1'}, "slow");
                    }
                )
            }
        );


        $("#formContainer").animate({opacity: '0'}, "slow",
            function () {
                console.log("showing spinner");
                $("#formContainer").addClass("d-none");
                $("#loadingSpinner").removeClass("d-none").animate({opacity: '1'}, "fast");
            }
        );

    }

    const getTestData = function () {

        if ($("#form")[0].reportValidity() == false) return;

        let url = generateAPIURLfromForm();

        //fetch(url)
        fetch("")
            //.then((ret) => ret.json())
            .then(ret => {
                responseSpritApi = ret; //save API call response
                return exampleResponse; //use only TestData
            })
            .then( writeValuesToDOM ).then(async function () {
                console.log("wait..");
                await sleep(2000);
                console.log("after wait");
                $("#loadingSpinner").animate({opacity: '0'}, "fast",
                    function () {
                        console.log("showing results");
                        $("#loadingSpinner").addClass("d-none");
                        $('#responseContainer').removeClass("d-none").animate({opacity: '1'}, "slow");
                    }
                )
            }
        );


        $("#formContainer").animate({opacity: '0'}, "slow",
            function () {
                console.log("showing spinner");
                $("#formContainer").addClass("d-none");
                $("#loadingSpinner").removeClass("d-none").animate({opacity: '1'}, "fast");
            }
        );

    }

    function generateAPIURLfromForm(){
        let url = 'http://localhost:8080/spritCalc?' +
            'city=' + $("#city")[0].value;
        if ($("#PLZ")[0].value) url = url + '&postalCode=' + $("#PLZ")[0].value;
        if ($("#street")[0].value) url = url + '&street=' + $("#street")[0].value;
        if ($("#streetNum")[0].value) url = url + '&streetNum=' + $("#streetNum")[0].value;
        url = url + '&petrolTyp=' + $("#inputSpritTyp")[0].value +
            '&petrolUsageCar=' + $("#Verbrauch")[0].value +
            '&petrolVolume=' + $("#Tankmenge")[0].value;
        console.log('url:' + url);
        return url;
    }

    function writeValuesToDOM(data) {
        $('#resultVerbrauch').html($('#Verbrauch').val());
        $('#resultTankmenge').html($('#Tankmenge').val());
        for (let i = 0; i < data.length; i++) {
            $('#card' + (i + 1) + " [name='header']").html(i + 1);
            $('#card' + (i + 1) + " [name='stationName']").html(data[i].petrolStationDat.name);
            $('#card' + (i + 1) + " [name='totalCost']").html("Gesamt: " + data[i].completePrice.toFixed(2).concat(" €"));
            $('#card' + (i + 1) + " [name='petrolCost']").html($("#inputSpritTyp") +
                " :" + data[i].petrolStationDat.price.toFixed(2).concat(" €"));
            $('#card' + (i + 1) + " [name='routeCost']").html("Fahrkosten: " + data[i].travelcost.toFixed(2).concat(" €"));
            $('#card' + (i + 1) + " [name='distance']").html("Entfernung: " + (data[i].routeData.distance / 1000).toFixed(1).concat("km"));
            $('#card' + (i + 1) + " [name='adress']").html(data[i].petrolStationDat.placeNamer + " " + data[i].petrolStationDat.postCode);
            $('#card' + (i + 1) + " [name='adress2']").html(data[i].petrolStationDat.street + " " + data[0].petrolStationDat.houseNumber);
        }
    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

</script>

</body>
</html>